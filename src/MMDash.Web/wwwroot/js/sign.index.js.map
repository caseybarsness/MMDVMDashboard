{"version":3,"sources":["sign.index.ts"],"names":[],"mappings":"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","file":"sign.index.js","sourcesContent":["\r\n/// <reference path=\"viewmodels.generated.d.ts\" />\r\n/// <reference types=\"datatables.net\" />\r\n/// <reference path=\"../node_modules/datatables.responsive.typings/index.d.ts\" />\r\n/// <reference types=\"google-maps\" />\r\n\r\n\r\n\r\nmodule MMDash {\r\n    export class SignModule {\r\n        private strCallSign = Coalesce.Utilities.GetUrlParameter(\"call\");\r\n        public servers = new ListViewModels.ServerList();\r\n        public sign = new ViewModels.CallSign();\r\n        public personName = ko.observable();\r\n        public expDate = ko.observable();\r\n        public fccUrl = ko.observable();\r\n        public opClass = ko.observable();\r\n        public grantDate = ko.observable();\r\n        public lat = ko.observable();\r\n        public long = ko.observable();\r\n        public isLoadingTransmissions = ko.observable(true);\r\n        public isLoadingStreams = ko.observable(true);\r\n\r\n\r\n      \r\n\r\n        public ajax = function (uri) {\r\n            var request = {\r\n                url: uri,\r\n                cache: false,\r\n                dataType: 'jsonp',\r\n                error: function (jqXHR) {\r\n                    console.log(\"ajax error \" + jqXHR.status);\r\n                }\r\n            };\r\n            return $.ajax(request);\r\n        };\r\n\r\n        loadFccInf(callback?: (self: this) => void) {\r\n            var self = this;\r\n            var fccUri = \"https://callook.info/\" + self.sign.text() + \"/json/test_callback\";\r\n            self.ajax(fccUri).done(function (data) {\r\n                self.personName(data.name);\r\n                self.expDate(data.otherInfo.expiryDate);\r\n                self.fccUrl(data.otherInfo.ulsUrl);\r\n                self.grantDate(data.otherInfo.grantDate);\r\n                self.opClass(data.current.operClass);\r\n                self.lat(data.location.latitude);\r\n                self.long(data.location.longitude);\r\n                if (typeof (callback) == \"function\") callback(this);\r\n            });\r\n        }\r\n        loadMap() {\r\n            var self = this;\r\n            //console.trace(self.long());\r\n            //console.trace(self.lat());\r\n            var numLat = parseFloat(self.lat().toString());\r\n            var numLong = parseFloat(self.long().toString())\r\n            var opts: google.maps.MapOptions = {\r\n                center: new google.maps.LatLng(numLat, numLong),\r\n                mapTypeId: google.maps.MapTypeId.TERRAIN,\r\n                zoom: 8\r\n            };\r\n            \r\n            var map = new google.maps.Map(document.getElementById(\"map\"), opts);\r\n            var marker = new google.maps.Marker({\r\n                position: new google.maps.LatLng(numLat, numLong),\r\n                animation: google.maps.Animation.DROP,\r\n                map: map\r\n            });\r\n        }\r\n\r\n\r\n        load() {\r\n            var self = this;\r\n            var lstCallSigns = new ListViewModels.CallSignList();\r\n            lstCallSigns.filter = {\r\n                text: self.strCallSign\r\n            }\r\n            lstCallSigns.load(function () {\r\n                if (lstCallSigns.items().length > 0) {\r\n                    self.sign = lstCallSigns.items()[0];\r\n                    self.loadFccInf(function () {\r\n                        self.loadMap();\r\n                    });\r\n                    self.servers.dataSource = new ListViewModels.ServerDataSources.ServersWithoutChildren();\r\n                    self.servers.load(function () {\r\n                        for (var i = 0; i < self.servers.items().length; i++) {\r\n                            self.LogsForServer(self.servers.items()[i].serverId(), lstCallSigns.items()[0].callSignId().toString());\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        public LogsForServer(serverId, signId) {\r\n            var self = this;\r\n            var streamList = new ListViewModels.StreamList();\r\n            var transmissionList = new ListViewModels.VoiceTransmissionList();\r\n            streamList.filter = {\r\n                serverId: serverId,\r\n                callSignId: signId\r\n            }\r\n            transmissionList.filter = {\r\n                serverId: serverId,\r\n                callSignId: signId\r\n            }\r\n\r\n            streamList.orderByDescending(\"streamDateTime\");\r\n            streamList.pageSize(100);\r\n            streamList.load(function () {\r\n                self.isLoadingStreams(false);\r\n                var streamsTables = $(\"#streams-table-\" + serverId).DataTable({\r\n                    \"paging\": true,\r\n                    \"ordering\": true,\r\n                    \"info\": true,\r\n                    data: streamList.items(),\r\n                    columns: [\r\n                        { data: 'streamDateTime', title: 'Date Time' },\r\n                        { data: 'talkGroup', title: 'Talk Group' },\r\n                        { data: 'repeaterId', title: 'Repeater ID' },\r\n                        { data: 'timeSlot', title: 'TS#' }\r\n                    ],\r\n                    columnDefs: [\r\n                        {\r\n                            \"render\": function (data, type, row) {\r\n                                var mDate: moment.Moment = data()\r\n                                return mDate.utc().add(-8, 'hours').format(\"YYYY-MM-DD HH:mm:ss\");\r\n                            },\r\n                            \"targets\": 0\r\n                        },\r\n                    ],\r\n                    order: [[0, \"desc\"]]\r\n                });\r\n            });\r\n\r\n            transmissionList.orderByDescending(\"transmissionDateTimeStart\")\r\n            transmissionList.pageSize(100);\r\n            transmissionList.load(function () {\r\n                self.isLoadingTransmissions(false);\r\n                var transmissionsTable = $(\"#transmission-table-\" + serverId).DataTable({\r\n                    \"paging\": true,\r\n                    \"ordering\": true,\r\n                    \"info\": true,\r\n                    data: transmissionList.items(),\r\n                    columns: [\r\n                        { data: 'transmissionDateTimeStart', title: 'Start' },\r\n                        { data: 'transmissionDateTimeEnd', title: 'End' },\r\n                        { data: 'talkGroup', title: 'Talk Group' },\r\n                        { data: 'lossRate', title: 'Loss' }\r\n                    ],\r\n                    columnDefs: [\r\n                        {\r\n                            \"render\": function (data, type, row) {\r\n                                var mDate: moment.Moment = data()\r\n                                return mDate.utc().add(-8, 'hours').format(\"YYYY-MM-DD HH:mm:ss\");\r\n                            },\r\n                            \"targets\": 0\r\n                        },\r\n                        {\r\n                            \"render\": function (data, type, row) {\r\n                                var mDate: moment.Moment = data()\r\n                                return mDate.utc().add(-8, 'hours').format(\"YYYY-MM-DD HH:mm:ss\");\r\n                            },\r\n                            \"targets\": 1\r\n                        },\r\n                        {\r\n                            \"render\": function (data, type, row) {\r\n                                return data() + \"%\";\r\n                            },\r\n                            \"targets\": 3\r\n                        }\r\n                    ],\r\n                    order: [[0, \"desc\"]]\r\n                });\r\n            })\r\n        }\r\n\r\n        constructor() {\r\n            var self = this;\r\n\r\n            //this.loadFccInfo();\r\n        }\r\n\r\n    }\r\n\r\n    $(function () {\r\n        var vm = new SignModule();\r\n        ko.applyBindings(vm);\r\n        vm.load();\r\n    })\r\n\r\n}"]}